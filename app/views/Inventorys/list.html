#{extends 'CRUD/layout.html' /}
#{set activeMenu:'Inventory'/}
#{set activeMenuSub:'InventoryList'/}
#{jqueryui-config /}
#{fileupload-config /}
#{ckeditor-config /}
#{fancybox-config /}
#{checkFileExtension /}
#{flashCrud /}
<script type="text/javascript" src="@{'/public/javascripts/validateOnlyNumber.js'}"></script>
<script src="/public/javascripts/jquery.resizableColumns.min.js"></script>

%{inventoryPermission = user.getUserPermissionType(controllers.Consts.permissionInventory);}%
%{attachNum =3;}%
<div id="main-content" class="dhidden" ${inventoryPermission==3 ? ""  : "hidden=\"true\""}>
    <div>
        <div class="m-b-0 clearfix">
            <div class="page-title pull-left">
                <h3 class="pull-left"><strong>&{'ItemManagement'}</strong></h3>
            </div>
            <div class="pull-right">
            #{if inventoryPermission==3}
                <button class="btn btn-success m-t-10 " data-toggle="modal" data-target="#modal-additem"><i
                        class="fa fa-plus p-r-10"></i> &{'add_new_item'}</button>
            #{/if}
            </div>
        </div>

        <form id="filterForm" action="@{Inventorys.list()}" method="get">
            <div class="col-md-3" style="padding: 0; padding-right: 6px;">
                <select data-live-search="true" id="supplier_filter"
                        class="form-control" name="supplier_filter">
                    <option value="0">&{'AllSupplier'}</option>
                    <option data-divider="true"></option>
                #{list items:Suppliers,as: 'supplier'}
                    <option value="${supplier.id}" ${supplier.id.toString() == supplier_filter ? 'selected' : ''}>${supplier.name}</option>
                #{/list}
                </select>
            </div>
            <div class="col-md-3" style="padding: 0; padding-right: 6px;">
                <select data-live-search="true" id="category_filter"
                        class="form-control" name="category_filter">
                    <option value="0">&{'AllCategory'}</option>
                    <option data-divider="true"></option>
                #{list items:Categories,as: 'category'}
                    <option value="${category.id}" ${category.id.toString() == category_filter ? 'selected' : ''}>${category.name}</option>
                #{/list}
                </select>
            </div>
            <div class="col-md-3" style="padding: 0; padding-right: 6px;">
                <select data-live-search="true" id="subcategory_filter"
                        class="form-control" name="subcategory_filter">
                    <option value="0">&{'AllSubCategory'}</option>
                    <option data-divider="true"></option>
                #{list items:SubCategories,as: 'subcategory'}
                    <option value="${subcategory.id}" ${subcategory.id.toString() == subcategory_filter ? 'selected' : ''}>${subcategory.name}</option>
                #{/list}
                </select>
            </div>
            <div class="col-md-2" style="padding: 0; padding-right: 6px;">
                <input type="text" class="form-control" style=";"
                       placeholder="&{'Search'}!" name="keyword" value="${keyword}"/>
            </div>
            <div class="col-md-1" style="padding: 0;">
                <button type="submit" class="btn btn-default"><i class="fa fa-search"></i></button>
            </div>
            <div class="col-md-2" style="padding: 0;">
                <input type="hidden" name="CurrentPageNumber" value="1"/>
            </div>
        </form>
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-12 col-sm-12 col-xs-12 table-responsive">
                                <table id="item-list-table" class="table table-tools table-hover"
                                       data-resizable-columns-id="inventory-resizalbe-table">
                                    <thead>
                                    <tr>
                                        <th></th>
                                        <th colspan="3" class="text-center">&{'item'}</th>
                                        <th colspan="4" class="text-center">&{'supplier'}</th>
                                        <th></th>
                                    </tr>
                                    <tr>
                                        <th class="text-center" style="width: 100px!important;" data-resizable-column-id="id">
                                            <strong>#</strong>
                                        </th>

                                        <th class="text-center" style="width: auto;" data-resizable-column-id="item">
                                            <strong>&{'name'}</strong>
                                        </th>
                                        <th class="text-center" style="width: 300px"
                                            data-resizable-column-id="category">
                                            <strong>&{'category'}</strong>
                                        </th>
                                        <th class="text-center" style="width: 90px" data-resizable-column-id="measure">
                                            <strong>&{'measure'}</strong>
                                        </th>
                                        <th class="text-center" style="width: 150px"
                                            data-resizable-column-id="supplier">
                                            <strong>&{'name'}</strong>
                                        </th>
                                        <th class="text-center" style="width: auto" data-resizable-column-id="price">
                                            <strong>&{'price'}</strong>
                                        </th>
                                        <th class="text-center" style="width: 150px" data-resizable-column-id="phone">
                                            <strong>&{'phone'}</strong>
                                        </th>
                                        <th class="text-center" style="width: auto" data-resizable-column-id="website">
                                            <strong>&{'website'}</strong>
                                        </th>
                                        <th class="text-center" style="width: auto" data-resizable-column-id="attach">
                                            <strong>&{'attachment'}</strong>
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    #{list items:Inventorys, as: 'inventory'}
                                    <tr style="height: 50px">
                                        <td><strong>${inventory.id}</strong></td>
                                        <td style="max-width: 100px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">${inventory.item}
                                            <strong
                                                    hidden="true">${inventory.id}</strong></td>
                                        <td>${inventory.inventorySubCategory.category.name}
                                            / ${inventory.inventorySubCategory.name}</td>
                                        <td class="text-center"> ${inventory.inventoryMeasure.measure}</td>
                                        <td style="padding-bottom: 0px!important;"><select data-live-search="true"
                                                                                           data-width="200px"
                                                                                           title="&{'supplier'}">
                                            #{if inventory.priceList.size()>0}
                                                #{list items:inventory.priceList, as:'supplier'}
                                                    <option value="${supplier.supplier.id}">${supplier.supplier.name}</option>
                                                #{/list}
                                            #{/if}
                                            #{else}
                                                <option></option>
                                            #{/else}
                                        </select></td>
                                        <td></td>
                                        <td></td>
                                        <td style="max-width: 200px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;"></td>
                                        <td>
                                            <div id="inventorys-list-attach${attachNum+inventory_index}">
                                                <ul class="uploadBox" id="u${attachNum+inventory_index}">
                                                    #{list items:inventory.inventoryAttachment, as:'attach'}
                                                        <li>
                                                            <span>
                                                                ${controllers.Functions.handleDocumentAttachment(attach.filedir,attach.filename,attach.extension,attach.filesize).raw()}
                                                            </span>
                                                        </li>
                                                    #{/list}
                                                </ul>
                                            </div>
                                        ${controllers.Functions.handleDocumentAttachmentImgGallery("inventorys-list-attach"+(attachNum+inventory_index)).raw()}
                                        </td>

                                    </tr>
                                    #{/list}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    #{if MaxPageNumber>1}
                        <div class="page-navigation" style="width: 100%; text-align: right;">
                            <a style="text-decoration: none;"
                               href="@{Inventorys.list(CurrentPageNumber - 1,keyword,category_filter,subcategory_filter,message)}">
                                <input
                                        class="number-button btn btn-default" ${ CurrentPageNumber - 1 <= 0 ? 'disabled': ''}
                                        style="padding-top: 5px; padding-bottom: 5px; padding-left: 10px; padding-right: 10px;"
                                        type="button"
                                        value="<"/>
                            </a>
                        %{
                            int threeDots = 0;
                            for(int i = 1; i <= MaxPageNumber; i++){
                            if( i == 1 || i == MaxPageNumber || (CurrentPageNumber < 3 && i < 5) ||
                            (CurrentPageNumber - 1 <= i && i <= CurrentPageNumber + 1) ||
                            (CurrentPageNumber > MaxPageNumber - 2 && i > MaxPageNumber - 4) ){
                            }%
                            <a style="text-decoration: none;"
                               #{if CurrentPageNumber != i}href="@{Inventorys.list(i,keyword,supplier_filter,category_filter,subcategory_filter,message)}"#{/if}>
                                <input
                                        class="number-button btn btn-${CurrentPageNumber == i ? 'dark':'default'}"
                                        style="padding-top: 5px; padding-bottom: 5px; padding-left: 10px; padding-right: 10px;"
                                        type="button"
                                        value="${i}"/>
                            </a>
                        %{ }else{
                            if( i == 2 || i == MaxPageNumber - 1 ){
                            threeDots = 1;
                            }
                            if(threeDots == 1){
                            }%
                            <span style="font-size: x-large;"><strong>...</strong></span>
                        %{
                            threeDots = 0;
                            }
                            }
                            }
                            }%
                            <a style="text-decoration: none;"
                               href="@{Inventorys.list(CurrentPageNumber+1,keyword,category_filter,subcategory_filter,message)}">
                                <input
                                        class="number-button btn btn-default" ${ CurrentPageNumber >= MaxPageNumber ? 'disabled': ''}
                                        style="padding-top: 5px; padding-bottom: 5px; padding-left: 10px; padding-right: 10px;"
                                        type="button"
                                        value=">"/>
                            </a>
                        </div>
                    #{/if}
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="modal-addcategory" aria-hidden="true" style="z-index: 6000">
        <div class="modal-dialog modal-lg" style="width: 700px">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title"><strong>&{'new_category'}</strong></h4>
                </div>
                <div class="modal-body">
                    <form action="@{InventoryCategorys.newCategory()}" class="form-horizontal" method="get"
                          accept-charset="utf-8" id="category_form_add"
                          enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="tabcordion">
                                    <div id="myTabContent" class="tab-content">
                                        <div class="tab-pane fade active in" id="product_general_add">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        </br>

                                                        <label class="col-sm-3 control-label"
                                                               style="font-size: larger">&{'category_name'} <span
                                                                class="asterisk">*</span>
                                                        </label>

                                                        <div class="col-sm-5">
                                                            <input hidden="true" id="category_id_add" name="id">

                                                            <div id="selectcat">
                                                                <select data-live-search="true" id="category"
                                                                        class="form-control " data-
                                                                        title="&{'category'}" name="selectcat">
                                                                    <option value="" id="empty"></option>
                                                                #{list items:Categories,as:'category'}
                                                                    <option value="${category.name}">
                                                                    ${category.name}
                                                                    </option>
                                                                #{/list}
                                                                </select>
                                                            </div>
                                                            <div id="inputcat" class="hidden">
                                                                <input type="text" class="form-control small"
                                                                       id="inputcategory_add"
                                                                       name="inputcat">
                                                            </div>

                                                            <input type="text" hidden="true" required="true" name="is"
                                                                   id="is" value="0">
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <div id="add">
                                                                <button type="button" class="btn btn-info"
                                                                        data-toggle="modal"
                                                                        id="add">&{'input_category'}</button>
                                                            </div>
                                                            <div id="select" class="hidden">
                                                                <button type="button" class="btn btn-info"
                                                                        data-toggle="modal"
                                                                        id="select">&{'select_category'}</button>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                            </br>
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="panel-body">
                                                        <div class="row">
                                                            <div class="col-md-12 col-sm-12 col-xs-12 table-responsive table-blue">
                                                                <table class="table table-striped table-hover dataTable"
                                                                       id="table-editable_add">
                                                                    <thead>
                                                                    <tr>
                                                                        <th style="width: auto">&{'subcategory'}</th>
                                                                        <th style="width: 92px"></th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    </tbody>
                                                                    <tfoot>
                                                                    <tr>
                                                                        <td></td>
                                                                        <td class="text-center"><a
                                                                                style="height: 24px!important; padding-top: 1px!important;"
                                                                                id="table-edit_new_add"
                                                                                class="add btn btn-icon-sm btn-rounded btn-default"
                                                                                href="#"><i class="fa fa-plus"></i></a>
                                                                        </td>
                                                                    </tr>
                                                                    </tfoot>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 m-t-20 m-b-40 align-center">
                                <button type="button" class="btn btn-success m-t-10" id="category_add"><i
                                        class="fa fa-check"></i> &{'save'}
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="modal-addmeasure" aria-hidden="true" style="z-index: 6000">
        <div class="modal-dialog modal-lg" style="width: 700px">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title"><strong>&{'add_new_measure'}</strong></h4>
                </div>
                <div class="modal-body">
                    <form action="@{InventoryMeasures.newMeasure()}" class="form-horizontal" method="get"
                          accept-charset="utf-8"
                          id="measure_form"
                          enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="tabcordion">
                                    <div id="myTabContent" class="tab-content">
                                        <div class="tab-pane fade active in" id="product_general">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="form-group">

                                                        <label class="col-sm-2 control-label">&{'measure'} <span
                                                                class="asterisk">*</span>
                                                        </label>

                                                        <div class="col-sm-7">
                                                            <input type="text" class="form-control"
                                                                   placeholder=&{'measure'}...
                                                                   required="true" id="input_measure"
                                                                   name="measure">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 m-t-20 m-b-40 align-center">
                                <button type="button" class="btn btn-success m-t-10" id="measure_add"><i
                                        class="fa fa-check"></i> &{'save'}
                                </button>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="modal-additem" aria-hidden="true" style="z-index: 5000;">
        <div class="modal-dialog modal-lg" style="width: 750px">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title"><strong>&{'add_new_item'}</strong></h4>
                </div>
                <div class="modal-body">
                    <form action="@{Inventorys.newItem()}" class="form-horizontal" method="get" accept-charset="utf-8"
                          enctype="multipart/form-data" id="form_item">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="tabcordion">
                                    <ul id="myTab" class="nav nav-tabs">
                                        <li class="active"><a href="#product_general" data-toggle="tab">&{'item'}</a>
                                        </li>
                                    </ul>
                                    <div id="myTabContent" class="tab-content">
                                        <div class="tab-pane fade active in" id="product_general">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="form-group">

                                                        <label class="col-sm-2 control-label">&{'item_name'} <span
                                                                class="asterisk">*</span>
                                                        </label>

                                                        <div class="col-sm-10">
                                                            <div class="dropdown">
                                                                <input type="text" class="form-control"
                                                                       placeholder=&{'name'}...
                                                                       required="true" id="item_add"
                                                                       name="item" autocomplete="off"
                                                                       data-toggle="dropdown"/>
                                                                <ul class="dropdown-menu scrollable-menu" id="suggest"
                                                                    role="menu" aria-labelledby="query">
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">&{'description'}
                                                        </label>

                                                        <div class="col-sm-10">
                                                <textarea rows="3" class="form-control" name="description"
                                                          style="resize: none"
                                                          placeholder=&{'description'}...></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row">
                                                        <label class="col-sm-2 control-label">&{'category'} <span
                                                                class="asterisk">*</span></label>

                                                        <div class="col-sm-5">
                                                            <select data-live-search="true" id="item_category"
                                                                    class="form-control"
                                                                    title="&{'category'}" name="subcategory"
                                                                    required="true">
                                                            #{list items:Categories,as:'category'}
                                                                <optgroup label="${category.name}">
                                                                    #{list items:category.subCategories, as:'subCategory' }
                                                                        <option value="${subCategory.id}">
                                                                        ${subCategory.name}
                                                                        </option>
                                                                    #{/list}
                                                                </optgroup>
                                                            #{/list}
                                                            </select>
                                                        </div>
                                                        <div class="col-sm-5">
                                                            <button type="button" class="btn btn-success"
                                                                    style="width: 100%" data-toggle="modal"
                                                                    data-target="#modal-addcategory"><span
                                                                    style="float: left;"><i
                                                                    class="fa fa-plus p-r-10"></i> &{'add_new_category'}</span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">&{'measure'} <span
                                                                class="asterisk">*</span></label>

                                                        <div class="col-sm-5">
                                                            <select data-live-search="true" id="measure"
                                                                    class="form-control"
                                                                    title="&{'measure'}" name="measure" required="true">

                                                            #{list items:Measures,as:'measure'}
                                                                <option value="${measure.id}">
                                                                ${measure.measure}
                                                                </option>
                                                            #{/list}
                                                            </select>
                                                        </div>
                                                        <div class="col-sm-5">
                                                            <button type="button" class="btn btn-success"
                                                                    style="width: 100%;" data-toggle="modal"
                                                                    data-target="#modal-addmeasure"><span
                                                                    style="float: left;"><i
                                                                    class="fa fa-plus p-r-10"></i> &{'add_new_measure'}</span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">&{'note'}
                                                        </label>

                                                        <div class="col-sm-10">
                                                    <textarea rows="3" class="form-control valid" name="item_note"
                                                              style="resize: none"
                                                              placeholder=&{'note'}...></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">&{'website'}
                                                        </label>

                                                        <div class="col-sm-10">
                                                            <input rows="5" class="form-control valid"
                                                                   name="item_website"
                                                                   style="resize: none"
                                                                   placeholder=&{'website'}...>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">&{'attachment'}
                                                        </label>

                                                        <div class="col-sm-10" id="inventorys-additem-attach">
                                                            <ul class="uploadBox" id="u1">
                                                                <li>
                                                                <span>
                                                                <button type="button"
                                                                        class="btn upload btn-default btn-icon-sm btn-rounded"
                                                                        data-rel="tooltip" title="Хавсаргах"><i
                                                                        class="fa fa-cloud-upload"></i></button>
                                                                </span>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div id="add_attach"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 m-b-40 align-center">
                                <button id="add_button" type="button"
                                        class="btn btn-success m-t-10"><i
                                        class="fa fa-check"></i> &{'save'}
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="modal-edititem" aria-hidden="true" style="z-index: 5000;">
        <div class="modal-dialog modal-lg" style="width: 750px">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title"><strong>&{'edit_item'}</strong></h4>
                </div>
                <div class="modal-body" id="edititem-modalbody">
                    <form action="@{Inventorys.saveItem()}" class="form-horizontal" method="get" accept-charset="utf-8"
                          enctype="multipart/form-data" id="form_edit">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="tabcordion">
                                    <div id="myTabContent" class="tab-content">
                                        <div class="tab-pane fade active in" id="product_general_edit">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="form-group">

                                                        <label class="col-sm-2 control-label">&{'name'} <span
                                                                class="asterisk">*</span>
                                                        </label>

                                                        <div class="col-sm-10">
                                                            <input type="text" class="form-control"
                                                                   placeholder=&{'name'}...
                                                                   required="true" id="item_name"
                                                                   name="item">
                                                            <input hidden="true" id="item_id" name="id">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">&{'description'}
                                                        </label>

                                                        <div class="col-sm-10">
                                                <textarea rows="3" class="form-control" name="description"
                                                          id="item_description"
                                                          style="resize: none"
                                                          placeholder=&{'description'}...></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row">
                                                        <label class="col-sm-2 control-label">&{'category'} <span
                                                                class="asterisk">*</span></label>

                                                        <div class="col-sm-5">
                                                            <select data-live-search="true" id="item_category_edit"
                                                                    class="form-control" disabled
                                                                    title="&{'category'}" name="subcategory"
                                                                    required="true">
                                                            #{list items:Categories,as:'category'}
                                                                <optgroup label="${category.name}">
                                                                    #{list items:category.subCategories, as:'subCategory' }
                                                                        <option value="${subCategory.id}">
                                                                        ${subCategory.name}
                                                                        </option>
                                                                    #{/list}
                                                                </optgroup>
                                                            #{/list}
                                                            </select>
                                                        </div>
                                                        <div class="col-sm-5">
                                                            <button type="button" class="btn btn-success"
                                                                    id="add_new_category"
                                                                    style="width: 100%" data-toggle="modal"
                                                                    data-target="#modal-addcategory"><span
                                                                    style="float: left;"><i
                                                                    class="fa fa-plus p-r-10"></i> &{'add_new_category'}</span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">&{'measure'} <span
                                                                class="asterisk">*</span></label>

                                                        <div class="col-sm-5">
                                                            <select data-live-search="true" id="measure_edit"
                                                                    class="form-control" disabled
                                                                    title="&{'measure'}" name="measure" required="true">

                                                            #{list items:Measures,as:'measure'}
                                                                <option value="${measure.id}">
                                                                ${measure.measure}
                                                                </option>
                                                            #{/list}
                                                            </select>
                                                        </div>
                                                        <div class="col-sm-5">
                                                            <button type="button" class="btn btn-success"
                                                                    id="add_new_measure"
                                                                    style="width: 100%;" data-toggle="modal"
                                                                    data-target="#modal-addmeasure"><span
                                                                    style="float: left;"><i
                                                                    class="fa fa-plus p-r-10"></i> &{'add_new_measure'}</span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">&{'note'}
                                                        </label>

                                                        <div class="col-sm-10">
                                                    <textarea rows="3" class="form-control valid" name="item_note"
                                                              id="item_note"
                                                              style="resize: none"
                                                              placeholder=&{'note'}...></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">&{'website'}
                                                        </label>

                                                        <div class="col-sm-10">
                                                            <input rows="5" class="form-control valid"
                                                                   name="item_website"
                                                                   id="item_website"
                                                                   style="resize: none"
                                                                   placeholder=&{'website'}...>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">&{'attachment'}
                                                        </label>

                                                        <div class="col-sm-10" id="inventorys-edititem-attach">
                                                            <ul class="uploadBox" id="u2">
                                                                <li>
                                                                <span>
                                                                <button type="button"
                                                                        class="btn upload btn-default btn-icon-sm btn-rounded"
                                                                        data-rel="tooltip" title="Хавсаргах"><i
                                                                        class="fa fa-cloud-upload"></i></button>
                                                                </span>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div id="edit_attach"></div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 m-b-40 align-center">
                                <button type="button" id="edit_save" class="btn btn-success m-t-10 dhidden"><i
                                        class="fa fa-check"></i> &{'save'}
                                </button>
                                <button type="button" id="edit_delete"
                                        class="btn btn-danger m-t-10 dhidden"><i
                                        class="fa fa-times-circle"></i> &{'delete'}
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
#{include "SharedView/AttachsMulti.html"/}


<script>
    $(window).load(function () {
    #{if message=="deletesuccess"}
        showSuccessMessage("Материал устгал амжилттай боллоо.");
    #{/if}
    #{if message=="deletefailed"}
        showErrorMessage("Материал устгал амжилтгүй боллоо.");
    #{/if}

        $('table#item-list-table tbody tr').each(function () {
            var row = $(this);
            var item = $(this).find('td:first-child strong').html();
            var supplier = $(this).find('td:nth-child(5) select').val();
            var attach = $(this).find('td:nth-child(9) div ul.uploadBox');
            $.ajax({
                type: "POST",
                data: {
                    inventory: item,
                    supplier: supplier
                },
                url: "/inventorysupplierdetails"
            }).success(
                    function (data) {
                        row.find('td:nth-child(6)').html(data[0]);
                        row.find('td:nth-child(7)').html(data[1]);
                        row.find('td:nth-child(8)').html('<a href="'+data[2]+'">'+data[2]+'</a>');
                    });


        });
        $('div#main-content').removeClass('dhidden');

        $(function () {
            $("table").resizableColumns({
                store: window.store
            });
        });
    });

    $(document).ready(function () {

        var dat = [""];
        var prev_size = 0;

        var oTable_add = $('#table-editable_add').dataTable({
            "aLengthMenu": [
                [5, 15, 20, -1],
                [5, 15, 20, "All"] // change per page values here
            ],
            "sDom": "",
            "oTableTools": {
                "sSwfPath": "/assets/plugins/datatables/swf/copy_csv_xls_pdf.swf"
            },
            // set the initial value
            "iDisplayLength": 10,
            "bPaginate": false,
            "sPaginationType": "bootstrap",
            "oLanguage": {
                'sEmptyTable': "Үр дүн байхгүй байна.",
                "sLengthMenu": "_MENU_ records per page",
                "oPaginate": {
                    "sPrevious": "Prev",
                    "sNext": "Next"
                },
                "sSearch": ""
            },
            "aoColumnDefs": [{
                'bSortable': false,
                'aTargets': [0]
            }
            ]
        });

        function editableTable_add() {


            jQuery('#table-edit_wrapper .dataTables_filter input').addClass("form-control medium"); // modify table search input
            jQuery('#table-edit_wrapper .dataTables_length select').addClass("form-control xsmall"); // modify table per page dropdown


            $('#table-edit_new_add').click(function (e) {
                e.preventDefault();

                oTable_add.fnAddData(['<input type="text" hidden="true" required="true" name="ids" value="0"><input type="text" class="form-control" required="true" name="subcategorys">',
                    '<div class="text-center"><a style="padding-right: 11px;padding-left: 11px" class="delete btn btn-icon-sm btn-rounded btn-default" href=""><i class="fa fa-times-circle"></i></a></div>'
                ]);

            });

            $('#table-editable_add a.delete').live('click', function (e) {
                e.preventDefault();

                if (confirm("&{'are_you_sure_to_remove'}") == false) {
                    return;
                }

                var nRow = $(this).parent().parent().parent();
                oTable_add.fnDeleteRow(nRow);


            });

            $('select#category').change(function () {
                $.ajax({
                    type: "POST",
                    data: {name: $(this).val()},
                    url: "/inventoryShowSubCategory"
                }).success(
                        function (data) {
                            for (var j = 0; j < prev_size / 2; j++)
                                oTable_add.fnDeleteRow(0);
                            dat = data;
                            prev_size = dat.length;
                            for (var i = 0; i < dat.length; i = i + 2) {
                                oTable_add.fnAddData(['<input type="text" hidden="true" name="ids" required="true" value="' + dat[i + 1] + '"><input type="text" class="form-control" required="true" name="subcategorys" value="' + dat[i] + '">',
                                    '<div class="text-center"><a style="padding-right: 11px;padding-left: 11px" class="delete btn btn-icon-sm btn-rounded btn-default" href=""><i class="fa fa-times-circle"></i></a></div>'
                                ]);
                            }
                            oTable_add.fnDraw();

                        });


            });

            $('input#inputcategory_add').change(function () {
                $.ajax({
                    type: "POST",
                    data: {category: $(this).val()},
                    url: "/inventoryCheckCategory"
                }).success(
                        function (data) {
                            if (data == "false") {
                                $('input#inputcategory_add').val("");
                                showErrorMessage("Ангилалын нэр давхцаж байна.");
                            }
                        });
            });

            $('button#add').click(function () {
                var select = $("div#selectcat");
                select.addClass("hidden");
                $('select#category').selectpicker('val', '');

                var input = $("div#inputcat");
                input.removeClass("hidden");
                input.attr("required", "true");

                var add = $("div#add");
                add.addClass("hidden");

                var select = $("div#select");
                select.removeClass("hidden");

                var is = $("input#is");
                is.val("1");
                for (var j = 0; j < prev_size; j++)
                    oTable_add.fnDeleteRow(1);


            });
            $('button#select').click(function () {
                var select = $("div#selectcat");
                select.removeClass("hidden");

                var input = $("div#inputcat");
                input.addClass("hidden");
                input.attr("required", "false");

                var add = $("div#add");
                add.removeClass("hidden");

                var select = $("div#select");
                select.addClass("hidden");

                var is = $("input#is");
                is.val("0");
                $("input#inputcategory_add").val("");
            });

            $('.dataTables_filter input').attr("placeholder", "&{'search'}...");

        };


        editableTable_add();

        $('button#category_add').click(function () {

            var is = 0;
            var rowCount = 0;
            $('div#modal-addcategory table#table-editable_add tbody tr').each(function () {
                if ($(this).find("td.dataTables_empty").val() == null) {
                    if ($(this).find('td:first-child input:nth-child(2)').val() == "")
                        is = 1;
                    rowCount++;

                }
            });

            if ($("input#is").val() == "0" && $("select#category option#empty").val() == $("select#category option:selected").val()) {
                showErrorMessage("Ангилал сонгон уу?");
            } else if ($("input#is").val() == "1" && $("input#inputcategory_add").val() == "") {
                showErrorMessage("Ангилал нэр оруулна уу?");
            } else if (rowCount == 0) {
                showErrorMessage("Мөр нэмнэ үү?");
            }
            else if (is == 1) {
                showErrorMessage("Шаардлагатай нүдийг бөглөнө үү?");
            }
            else {
                var subs = [];
                var ids = [];
                var i = 0;
                $("table#table-editable_add tbody tr").each(function () {
                    subs[i] = $(this).find("td input:nth-child(2)").val();
                    ids[i] = $(this).find("td input:first-child").val();
                    i++;
                });


                $.ajax({
                    type: "POST",
                    data: {
                        selectcat: $('form#category_form_add select#category option:selected').val(),
                        inputcat: $('form#category_form_add input#inputcategory_add').val(),
                        subcategorys: subs,
                        ids: ids,
                        is: $("input#is").val()
                    },
                    url: "/inventorycategoryaddcategory"
                }).success(
                        function (data) {

                            if (data[0] != "false") {

                                if ($("input#is").val() == "0") {
                                    var x = document.createElement("optgroup");
                                    var label = $('form#category_form_add select#category option:selected').val();
                                    x.setAttribute("label", label);
                                }
                                else {
                                    var x = document.createElement("optgroup");

                                    var x1 = document.createElement("option");

                                    x1.text = $('form#category_form_add input#inputcategory_add').val();
                                    x1.value = $('form#category_form_add input#inputcategory_add').val();

                                    var z1 = document.getElementById("category");
                                    z1.add(x1);

                                    $('select#category').selectpicker('refresh');

                                    var label = $('form#category_form_add input#inputcategory_add').val();
                                    x.setAttribute("label", label);

                                }

                                for (var i = 0; i < subs.length; i++) {
                                    var option = document.createElement("option");
                                    option.text = subs[i];
                                    option.value = data[i];
                                    x.appendChild(option);
                                }

                                var z = document.getElementById("item_category");
                                z.add(x);
                                $('select#item_category').selectpicker('refresh');
                                showSuccessMessage("Ангилал нэмэлт амжилттай боллоо.");
                                $('div#modal-addcategory').modal('hide');
                            }
                            if (data == "false")
                                showErrorMessage("Ангилал нэмэлт амжилтгүй боллоо.");
                            Reload_Category();
                        });
            }

        });
        function Reload_Category() {

            $("table#table-editable tbody tr").each(function () {
                oTable_add.fnDeleteRow(0);
            });
            oTable_add.fnAddData(['<input type="text" hidden="true" name="ids" required="true" value="0"><input type="text" class="form-control" required="true" name="subcategorys">',
                '<div class="text-center"><a style="padding-right: 10px;padding-left: 10px" class="edit btn btn-success" href=""><i class="fa fa-check"></i></a><a style="padding-right: 11px;padding-left: 11px" class="delete btn btn-danger" href=""><i class="fa fa-times-circle"></i></a></div>'
            ]);

            $("input#inputcategory_add").val("");
            $('select#category').selectpicker('val', '');
            oTable_add.fnDraw();
        }


        $('.dataTables_filter input').attr("placeholder", "&{'search'}...");


        $('button#measure_add').click(function () {
            $('select#measure').selectpicker();
            $.ajax({
                type: "POST",
                data: {measure: $('form#measure_form input').val()},
                url: "/inventorymeasuresaddmeasure"
            }).success(
                    function (data) {
                        if (data != "false") {
                            var option = document.createElement("option");
                            option.text = $("input#input_measure").val();
                            option.value = parseInt(data);
                            var z = document.getElementById("measure");
                            z.add(option);

                            $('select#measure').selectpicker('refresh');
                            $("div#modal-addmeasure").modal('hide');
                            showSuccessMessage("Нэгж нэмэлт амжилттай боллоо.");
                            $("input#input_measure").val("");
                        }
                        else {
                            $("input#input_measure").val("");
                            showErrorMessage("Нэгж нэмэлт амжилтгүй боллоо.");
                        }

                    });
        });

        var opt_item = {};

        // Tools: export to Excel, CSV, PDF & Print
        opt_item.sDom = "",
                opt_item.oLanguage = {"sSearch": "", 'sEmptyTable': "Үр дүн байхгүй байна."} ,
                opt_item.iDisplayLength = 40,

                opt_item.oTableTools = {
                    "sSwfPath": "/assets/plugins/datatables/swf/copy_csv_xls_pdf.swf",
                    "aButtons": ["csv", "xls", "pdf", "print"]
                };
        opt_item.aaSorting = [[0, 'desc']]
        opt_item.aoColumnDefs = [
            {'bSortable': false, 'aTargets': []}
        ];


        var oTable_item = $('#item-list-table').dataTable(opt_item);
        oTable_item.fnDraw();

        /* Add a placeholder to searh input */
        $('.dataTables_filter input').attr("placeholder", "Search a product...");

        $('button#add_button').on('click', function (e) {
            e.preventDefault();
            var obj = $('div#add_attach');
            if ($('input#item_add').val() == "") {
                showErrorMessage("Шардлагатай нүдийг бөглөнө үү?");
            }
            else {
                $("div#modal-additem form ul.uploadBox img.imgIcon").each(function () {
                    obj.append("<input type=\"hidden\" name=\"filename\" value=" + $(this).attr('filename') + ">" +
                    "<input type=\"hidden\" name=\"filedir\" value=" + $(this).attr('filedir') + ">" +
                    "<input type=\"hidden\" name=\"extension\" value=" + $(this).attr('extension') + ">" +
                    "<input type=\"hidden\" name=\"filesize\" value=" + $(this).attr('filesize') + ">");
                });
                $.ajax({
                    type: "POST",
                    data: $('div#modal-additem form').serialize(),
                    url: "/inventorysnewitem"
                }).complete(
                        function () {
                            location.reload();
                        });

            }
        });


        /* Delete a product */
        $('button#edit_delete').live('click', function (e) {
            e.preventDefault();
            if (confirm("&{'are_you_sure_to_remove_inventory'}") == false) {
                return;
            }
            var index = $('input#item_id').val();
            $.ajax({
                type: "POST",
                data: {id: index},
                url: "/inventorysdeleteitem"
            }).success(
                    function (data) {
                        if (data == "deletesuccess") {
                            showSuccessMessage("Материал устгал амжилттай боллоо.");
                            $('#item-list-table tbody tr').each(function () {
                                if ($(this).find('strong:first-child').html() == index) {
                                    oTable_item.fnDeleteRow($(this).find('td').parents('tr')[0]);
                                }

                            });
                            $('div#modal-edititem').modal('hide');
                        }
                        if (data == "deletefailed") {
                            showErrorMessage("Материал устгал амжилтгүй боллоо.");
                        }

                    });

        });

        var dat_edit = ["", ""];

        $('#item-list-table tbody tr td:first-child,#item-list-table tbody tr td:nth-child(2),#item-list-table tbody tr td:nth-child(3),#item-list-table tbody tr td:nth-child(4),#item-list-table tbody tr td:nth-child(6),#item-list-table tbody tr td:nth-child(7)').on('click', function (e) {
            e.preventDefault();
            var nRow_item = $(this).parent('tr');

            var index = $(nRow_item).find('td:nth-child(1) strong').html();


            $.ajax({
                type: "POST",
                data: {id: index},
                url: "/inventoryspreviewitem"
            }).success(
                    function (data) {
                        $('div#modal-edititem div#edititem-modalbody').html(data);
                        $('div#modal-edititem div#edititem-modalbody select#item_category_edit').selectpicker('render');
                        $('div#modal-edititem div#edititem-modalbody select#measure_edit').selectpicker('render');
                        $('div#modal-edititem input#item_id').attr('readonly', true);
                        $('div#modal-edititem input#item_name').attr('readonly', true);
                        $('div#modal-edititem textarea#item_description').attr('readonly', true);
                        $('div#modal-edititem select#item_category_edit').attr('disabled', true);
                        $('div#modal-edititem select#item_category_edit').selectpicker('refresh');
                        $('div#modal-edititem select#measure_edit').attr('disabled', true);
                        $('div#modal-edititem select#measure_edit').selectpicker('refresh');
                        $('div#modal-edititem button#add_new_category').addClass("dhidden");
                        $('div#modal-edititem button#add_new_measure').addClass("dhidden");
                        $('div#modal-edititem button#edit_save').addClass("dhidden");
                        $('div#modal-edititem button#edit_delete').addClass("dhidden");
                        $('div#modal-edititem textarea#item_note').attr('readonly', true);
                        $('div#modal-edititem input#item_website').attr('readonly', true);

                    #{if user.getUserPermissionType('inventory')==3}
                        $('div#modal-edititem input#item_id').attr('readonly', false);
                        $('div#modal-edititem input#item_name').attr('readonly', false);
                        $('div#modal-edititem textarea#item_description').attr('readonly', false);
                        $('div#modal-edititem select#item_category_edit').removeAttr("disabled", false);
                        $('div#modal-edititem select#item_category_edit').selectpicker('refresh');
                        $('div#modal-edititem select#measure_edit').removeAttr("disabled", false);
                        $('div#modal-edititem select#measure_edit').selectpicker('refresh');
                        $('div#modal-edititem button#add_new_category').removeClass("dhidden");
                        $('div#modal-edititem button#add_new_measure').removeClass("dhidden");
                        $('div#modal-edititem button#edit_save').removeClass("dhidden");
                        $('div#modal-edititem button#edit_edit').addClass("dhidden");
                        $('div#modal-edititem button#edit_delete').addClass("dhidden");

                        $('div#modal-edititem textarea#item_note').attr('readonly', false);
                        $('div#modal-edititem input#item_website').attr('readonly', false);

                        $('div#modal-edititem button#edit_save').removeClass("dhidden");
                        $('div#modal-edititem button#edit_delete').removeClass("dhidden");

                    #{/if}
                        $('div#modal-edititem').modal('show');
                    });
        });


        $('#item-list-table a.view_location').on('click', function (e) {
            e.preventDefault();
            var nRow_item = $(this).parents('tr')[0];

            var index = $(nRow_item).find('td:nth-child(1) strong').html();
            $.ajax({
                type: "POST",
                data: {id: index},
                url: "/inventoryspreviewlocation"
            }).success(
                    function (data) {
                        $('div#modal-previewlocation table#item-list-table_preview tbody').html(data);
                    });
        });

        $('input#item_add').change(function () {
            $.ajax({
                type: "POST",
                data: {inventory: $(this).val()},
                url: "/inventoryCheckInventory"
            }).success(
                    function (data) {
                        if (data == "false") {
                            $('input#item_add').val("");
                            showErrorMessage("Материал нэр давхцаж байна.");
                        }
                    });
        });
        $('input#item_add').keyup(function () {
            $.ajax({
                type: "POST",
                data: {inventory: $(this).val()},
                url: "/inventoryLikeInventory"
            }).success(
                    function (data) {
                        if (data != "false") {
                            $('ul#suggest').html("");
                            for (var i = 0; i < data.length; i++)
                                $('ul#suggest').append('<li><a class="result" data-id="">' + data[i] + '</a></li>');
                        }
                    });
        });

        $('input#item_name').change(function () {
            $.ajax({
                type: "POST",
                data: {
                    inventory: $(this).val(),
                    id: $('input#item_id').val()
                },
                url: "/inventoryCheckInventoryEdit"
            }).success(
                    function (data) {
                        if (data == "false") {
                            $('input#item_name').val("");
                            showErrorMessage("Материал нэр давхцаж байна.");
                        }
                    });
        });
//asd

        $('select#category_filter').change(function () {
            $.ajax({
                type: "POST",
                data: {id: $(this).val()},
                url: "/inventoryShowSubCategoryFilter"
            }).success(
                    function (data) {
                        $('select#subcategory_filter').html('<option value="0">&{'AllSubCategory'}</option>');
                        for (var i = 0; i < data.length; i = i + 2) {
                            $('select#subcategory_filter').html($('select#subcategory_filter').html() + '<option value="' + data[i + 1] + '">' + data[i] + '</option>');

                        }
                        $('select#subcategory_filter').selectpicker('refresh');
                    });
        });
        $('table#item-list-table tbody tr td:nth-child(5) select').change(function () {
            var row = $(this).parent('td').parent('tr');
            var item = row.find('td:first-child strong').html();
            var supplier = $(this).val();
            $.ajax({
                type: "POST",
                data: {
                    inventory: item,
                    supplier: supplier
                },
                url: "/inventorysupplierdetails"
            }).success(
                    function (data) {
                        row.find('td:nth-child(6)').html(data[0]);
                        row.find('td:nth-child(7)').html(data[1]);
                        row.find('td:nth-child(8)').html('<a href="'+data[2]+'">'+data[2]+'</a>');
                    });
        });

    });

</script>

<style>
    table#item-list-table td:nth-child(4) , table#item-list-table thead tr:nth-child(2) th:nth-child(4) , table#item-list-table thead tr:first-child th:nth-child(2) ,table#item-list-table td:nth-child(8) , table#item-list-table thead tr:nth-child(2) th:nth-child(8) , table#item-list-table thead tr:first-child th:nth-child(3) {
        border-right: solid;
        border-right-color: #a9a9a9;
        border-right-width: 1px;
    }
    .panel-body {
        background-color: #FFF;
        padding: 0px;
        padding-left: 0px;
    }

    div#main-content body, div#main-content ul, div#main-content li {
        font-size: 12px;
        font-family: Arial, Helvetica, sans-serif;
        line-height: 21px;
        text-align: left;
    }

</style>

#{AttachScriptMulti uploadPath:controllers.Consts.uploadInventoryPath/}
#{inventory-config /}
#{ImgThumbnail /}